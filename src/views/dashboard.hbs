<div class="px-4">
    <div class="row g-3 my-2">
        <h1 id="user_token">{{this.user_token}}</h1>
        {{#each data}}
            <div class="row shadow-sm text-center col mx-3 ">
                <h1 class="text-center text-white bg-secondary bg-gradient">{{this.valve_name}}</h1>
                <div class="col bg-dark bg-gradient">
                    <a class="col btn">
                        <!-- <img src="https://dlsgc.com.vn/wp-content/uploads/2021/07/bo-loc-afa-247x247.jpg" alt="" class="card-img-top  "> -->
                        <div class="card-body">
                            <div class="row">
                                <h5 class="col text-end text-white">Status:</h5>
                                <h5
                                    class=" col justify-content-start {{#if this.valve_status}} text-success  {{else}} text-danger {{/if}} ">
                                    {{#if this.valve_status}} ON {{else}} OFF {{/if}}
                                </h5>
                            </div>
                            <div class="row ">
                                <h5 class="col text-end text-white">Mode:</h5>
                                <div class="col  justify-content-start form-check form-switch parent">
                                    <input type="checkbox" id="{{concat 'togBtn' @index}}" value="true"
                                        class="form-check-input" checked>
                                </div>
                            </div>
                            <!-- <p class="fs-5 fw-bold text-primary">{{this.data.age}}</p> -->
                        </div>
                    </a>
                </div>
                <div class="col bg-info bg-gradient">
                    <form class="col col-lg-6 text-center parent" action="/" method="POST"
                        id="form-schedule-valve_{{@index}}">
                        <!-- <span class="">Van 1</span> -->
                        <div class="text-center">
                            <div class="col mt-3 d-flex justify-content-center">
                                <input name="date" id="startDate_{{@index}}" class="form-control" type="date"
                                    value="" />
                            </div>
                            <div class="col mt-3">
                                <input name="time" id="startTime_{{@index}}" type="time" class="form-control" />
                            </div>
                        </div>
                        <form id="switch-valve_{{@index}}" method="POST" class="form-schedule_{{@index}}">
                            <div class="form-check form-switch parent container-fluid justify-content-start mt-3">
                                <input type="checkbox" id="togBtnSchedule_{{@index}}" value="true"
                                    class="form-check-input" checked>
                            </div>
                        </form>
                        <button id="submit_{{@index}}" type="submit"
                            class="container-fluid btn btn-primary my-3">LÆ°u</button>
                    </form>
                </div>
            </div>
        {{/each}}
        <!-- <div class="card bg-primary text-white" style="width: 200px;">
            <div class="card-body d-flex justify-content-center align-items-center rounded-circle"
                style="height: 200px;">
                <h1>Circle Card</h1>
            </div>
        </div> -->
    </div>
</div>
<script>
    const socket = io();
    let switchStatusValveSchedule = true;

    const userToken = document.getElementById('user_token');
    const userTokenContent = userToken.textContent;
    if (!userTokenContent) {
        window.location.href = `./`;
    }
    else {
        userToken.textContent = '';
    }



    $(document).ready(function () {
        $('input[type="checkbox"]').click(function () {
            var checkboxId = $(this).attr('id');
            var isChecked = $(this).is(':checked');
            console.log('Checkbox with ID ' + checkboxId + ' is ' + (isChecked ? 'checked' : 'unchecked'));
        });

        //Schedule
        let currentTime = new Date().toLocaleTimeString().split(" ")[0].slice(0, 5);
        const f = new Date();

        let startDate1 = document.getElementById('startDate_1');
        if (startDate1 !== null) {
            startDate1.valueAsDate = new Date(f.getFullYear(), f.getMonth(), f.getDate(), 12);
        }

        let startDate2 = document.getElementById('startDate_2');
        if (startDate2 !== null) {
            startDate2.valueAsDate = new Date(f.getFullYear(), f.getMonth(), f.getDate(), 12);
        }

        let startDate3 = document.getElementById('startDate_0');
        if (startDate3 !== null) {
            startDate3.valueAsDate = new Date(f.getFullYear(), f.getMonth(), f.getDate(), 12);
        }

        let startTime1 = document.getElementById("startTime_1");
        if (startTime1 !== null) {
            startTime1.value = currentTime;
        }

        let startTime2 = document.getElementById("startTime_2");
        if (startTime2 !== null) {
            startTime2.value = currentTime;
        }

        let startTime3 = document.getElementById("startTime_0");
        if (startTime3 !== null) {
            startTime3.value = currentTime;
        }


        // submit schedule-valve1
        for (let i = 0; i < 3; i++) {

            // $(`#submit_${i}`).click(function () {
            //     $.post($(`#form-schedule-valve_${i}`).attr("action"),
            //         $(`#form-schedule-valve_${i} :input`).serializeArray(),
            //         function (info) {

            //             $("#response").empty();
            //             $("#response").html(info);
            //             socket.emit(`date_time_${i}`, {
            //                 schedule: $(`#form-schedule-valve_${i} :input`).serializeArray(),
            //                 status_btn: switchStatusValveSchedule,
            //             })
            //             console.log('====================================');
            //             console.log($(`#form-schedule-valve_${i} :input`).serializeArray());
            //             console.log('====================================');
            //         });

            //     $(`#form-schedule-valve_${i}`).submit(function () {
            //         return false;
            //     });
            // });

            document.getElementById(`submit_${i}`)?.addEventListener("click", function (event) {
                event.preventDefault(); // prevent the default form submission

                // get the value of the date and time inputs
                const dateInput = document.getElementById(`startDate_${i}`);
                const timeInput = document.getElementById(`startTime_${i}`);
                const dateValue = dateInput.value;
                const timeValue = timeInput.value;

                // extract the hour and minute from the time value
                const [hour, minute] = timeValue.split(":");

                // create a new Date object with the selected date and time
                const selectedDate = new Date(`${dateValue}T${timeValue}`);

                // log the selected date and time to the console

                socket.emit(`date_time_${i}`, {
                    schedule: {
                        date: selectedDate, Hour: hour, Minute: minute
                    },
                    status_btn: switchStatusValveSchedule,
                })
                console.log(`Selected date and time: ${selectedDate}, Hour: ${hour}, Minute: ${minute}`);
            });

            //schedule btn status
            // $('input[type="checkbox"]').click(function () {
            //     var checkboxId = $(this).attr('id');
            //     var isChecked = $(this).is(':checked');
            //     console.log('Checkbox with ID ' + checkboxId + ' is ' + (isChecked ? 'checked' : 'unchecked'));
            // });
            $(`#togBtnSchedule_${i}`).on('change', function () {
                if ($(this).is(':checked')) {
                    switchStatusValveSchedule = $(this).is(':checked');


                } else {
                    switchStatusValveSchedule = $(this).is(':checked');

                }
            });
        }
    });



</script>